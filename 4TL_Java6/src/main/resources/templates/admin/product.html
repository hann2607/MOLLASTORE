<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
	th:replace="~{/layoutadmin/layout.html :: dynamic(~{::title},~{::body})}">

<head>
<title>PRODUCT MANAGEMENT</title>
</head>
<body ng-controller="productMana">
	<div class="body flex-grow-1 px-3">
		<div class="container-lg">
			<form>
				<div class="row">
					<div class="col-5">
						<div class="form-group">
							<label for="productName">Product's Name</label> <input
								ng-model="form.name" type="text" class="form-control mt-2"
								id="productName">
						</div>
					</div>
					<div class="col">
						<div class="form-group">
							<label for="Price">Price</label> <input type="text"
								ng-model="form.price" class="form-control mt-2" id="Price">
						</div>
					</div>
					<div class="col">
						<div class="form-group">
							<label for="Available">Available</label>
							<div class="row mt-3">
								<div class="col-auto">
									<div class="form-check form-check-inline">
										<input class="form-check-input" ng-model="form.available"
											ng-value="true" type="radio" name=available id="conhang">
										<label class="form-check-label" for="conhang">CÒN HÀNG</label>
									</div>
									<div class="form-check form-check-inline">
										<input class="form-check-input" ng-model="form.available"
											ng-value="false" type="radio" name="available" id="hethang">
										<label class="form-check-label" for="hethang">HẾT HÀNG</label>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="row mt-4">
					<div class="col-3">
						<div class="form-group">
							<label for="Category">Category</label> <select
								class="form-select mt-2" ng-model="form.category.id"
								aria-label="Default select example">
								<option ng-repeat="cate in categories" ng-value="cate.id">{{cate.name}}</option>
							</select>
						</div>
					</div>
					<div class="col">
						<div class="form-group">
							<label for="Source">Source</label> <input type="text"
								ng-model="form.source" class="form-control mt-2" id="Source">
						</div>
					</div>
				</div>
				<div class="mt-4">
					<label for="details" class="form-label">Product Description</label>
					<textarea class="form-control" id="details" rows="5"
						ng-model="form.details"></textarea>
				</div>
				<div class="row mt-4">
					<div class="col-3">
						<div class="mb-3">
							<label for="imageInput" class="form-label">Chọn hình ảnh</label>
							<input type="file" class="form-control" id="imageInput">
						</div>
						<!-- Div card hiển thị hình ảnh đã chọn -->
						<div class="card">
							<div class="card-body">
								<img src="#" class="img-fluid" id="selectedImage">
							</div>
						</div>
					</div>
					<div class="col">
						<!--thumbnails-->
						<div class="mb-3">
							<label for="imageThumbnails" class="form-label">Choose 3
								Thumbnails</label> <input type="file" class="form-control"
								id="imageThumbnails" multiple>
						</div>
						<div class="card">
							<div class="card-body">
								<div class="row" id="selectedThumbnails"></div>
							</div>
						</div>
					</div>
				</div>
				<div class="row-cols-6 d-flex justify-content-between mt-4">
					<button type="submit" class="btn btn-primary mt-4">
						<i class="fa-solid fa-plus"></i> Create
					</button>
					<button type="submit" class="btn btn-success mt-4">
						<i class="fa-solid fa-pen-nib"></i> Update
					</button>
					<button type="submit" class="btn btn-danger mt-4">
						<i class="fa-solid fa-trash"></i> Delete
					</button>
					<button type="submit" class="btn btn-warning mt-4"
						ng-click="reset()">
						<i class="fa-solid fa-broom"></i> Reset
					</button>
					<button type="submit" class="btn btn-info mt-4">
						<i class="fa-solid fa-magnifying-glass"></i> Preview
					</button>
				</div>
			</form>
			<br>
			<hr>
			<br>
			<div class="row flex-row-reverse">
				<div class="input-group w-25">
					<input type="search" class="form-control rounded"
						placeholder="Search by product's name..." aria-label="Search"
						aria-describedby="search-addon" />
					<button type="button" class="btn btn-outline-primary">search</button>
				</div>
			</div>
			<table class="table table-bordered text-center"
				th:if="user.orders.empty">
				<caption
					style="caption-side: top; text-align: center; font-size: 3rem; font-weight: 800;">LIST
					PRODUCTS</caption>
				<thead>
					<tr>
						<th scope="col">Product's Name</th>
						<th scope="col">Price</th>
						<th scope="col">Poster</th>
						<th scope="col">Thumbnails</th>
						<th scope="col">Source</th>
						<th scope="col">Action</th>
					</tr>
				</thead>
				<tbody>
					<tr ng-repeat="product in items"
						ng-if="$index >= minQuantityProduct && $index < maxQuantityProduct">
						<td>{{product.name}}</td>
						<td>{{formatCurrency(product.price)}}</td>
						<td>{{product.poster}}</td>
						<td>{{product.thumbnail}}</td>
						<td
							style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
							{{product.source}}</td>
						<td><a class="btn btn btn-success"
							ng-click="edit(product.id)">Edit</a> <a
							class="btn btn btn-danger" ng-click="delete(product.id)">Delete</a></td>
					</tr>
				</tbody>
			</table>
			<nav aria-label="...">
				<ul class="pagination justify-content-end">
					<li class="page-item" ng-click="prevPage()"
						style="cursor: pointer;"><a class="page-link">Previous</a></li>
					<li class="page-item"
						ng-repeat="pageNum in [].constructor(pageTotal) track by $index"
						style="cursor: pointer;"><a class="page-link"
						ng-click="changePage($index + 1)">{{$index + 1}}</a></li>

					<li class="page-item" ng-click="nextPage()"
						style="cursor: pointer;"><a class="page-link">Next</a></li>
				</ul>
			</nav>
		</div>
	</div>
	<script>
		// Xử lý sự kiện khi chọn hình ảnh
		document
				.getElementById("imageInput")
				.addEventListener(
						"change",
						function(event) {
							// Lấy thông tin file đã chọn
							var selectedFile = event.target.files[0];
							// Tạo đường dẫn cho hình ảnh đã chọn
							var selectedFileUrl = URL
									.createObjectURL(selectedFile);
							// Hiển thị hình ảnh đã chọn lên div card
							document.getElementById("selectedImage").src = selectedFileUrl;
						});

		document.getElementById("imageThumbnails").addEventListener(
				"change",
				function(event) {
					let files = event.target.files;
					let row = document.createElement("div");
					row.classList.add("row");

					for (let i = 0; i < files.length; i++) {
						let file = files[i];
						let url = URL.createObjectURL(file);
						let img = document.createElement("img");
						img.src = url;
						img.classList.add("img-thumbnail");
						let div = document.createElement("div");
						div.classList.add("col-md-4", "mb-3");
						div.appendChild(img);
						row.appendChild(div);

						// Thêm một hàng mới sau mỗi 3 hình ảnh
						if ((i + 1) % 3 == 0) {
							document.getElementById("selectedThumbnails")
									.appendChild(row);
							row = document.createElement("div");
							row.classList.add("row");
						}
					}

					// Nếu số hình ảnh không chia hết cho 3, thêm hàng cuối cùng
					if (files.length % 3 != 0) {
						document.getElementById("selectedThumbnails")
								.appendChild(row);
					}
				});
	</script>
	<script type="text/javascript" src="/admin/js/api/productMana.js"></script>
</body>

</html>